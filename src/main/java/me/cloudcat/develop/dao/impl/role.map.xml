<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="me.cloudcat.develop.dao.RoleDao">
    <!--启用缓存,设定缓存存储策略为先进先出，缓存刷新间隔为10秒钟，并发访问策略为只读 -->
    <!--    <cache eviction="FIFO" flushInterval="10000" size="512" readOnly="true"/>-->

    <!--设置ehcache缓存 -->
    <cache type="org.mybatis.caches.ehcache.EhcacheCache" />

    <resultMap type="Role" id="roleMap" autoMapping="true">
        <collection property="resources" ofType="Resource" autoMapping="true"/>
    </resultMap>

    <sql id="basic_header">
        SELECT r.*
        FROM tbl_role r
    </sql>

    <sql id="detail_header">
        SELECT r.*, re.
    </sql>

    <select id="getBasic" resultMap="userMap">
        <include refid="basic_header"/>
        <where>
            id = #{id}
        </where>
    </select>

    <select id="findOne" resultMap="userMap">
        <include refid="detail_header"/>
        <where>
            id = #{id}
        </where>
    </select>

    <select id="findByCondition" resultMap="userMap" >
        <include refid="detail_header"/>
        <where>
            <if test="e.email!=null}">
                AND u.email = #{e.email}
            </if>
            <if test="e.username!=null}">
                AND u.email = #{e.username}
            </if>
            <if test="e.status!=null}">
                AND u.status = #{e.status}
            </if>
        </where>
    </select>

    <select id="findAll" resultMap="userMap">
        <include refid="detail_header"/>
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="e.id">
        insert into tbl_user(username, email, password, status)
        VALUES(#{e.username}, #{e.email}, #{e.password}, #{e.status})
    </insert>

</mapper>